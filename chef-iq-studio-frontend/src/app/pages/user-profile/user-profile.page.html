<!-- src/app/pages/user-profile/user-profile.page.html -->
<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-button (click)="goBack()">
        <ion-icon name="arrow-back-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title>{{ userProfile?.name || 'Profile' }}</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="ion-padding">

  <div *ngIf="userProfile" class="user-profile-container">
    <div class="header-section">
      <ion-avatar class="profile-avatar">
        
        <img [src]="userProfile.profileImage || 'assets/images/chef-default-dp.png'" alt="Profile Picture">
      </ion-avatar>
      <ion-text>
        <h1>{{ userProfile.name }}</h1>
        <p class="followers-text">{{ userProfile.followersCount || 0 }} Followers</p>
      </ion-text>

      <ion-button
        *ngIf="!isOwner"
        expand="block"
        shape="round"
        [fill]="userProfile.isFollowing ? 'solid' : 'outline'"
        [color]="userProfile.isFollowing ? 'medium' : 'primary'"
        (click)="toggleFollow()">
        <ion-icon
          slot="start"
          [name]="userProfile.isFollowing ? 'person-remove-outline' : 'person-add-outline'"></ion-icon>
        {{ userProfile.isFollowing ? 'Following' : 'Follow' }}
      </ion-button>
    </div>

    <ion-segment value="recipes" class="profile-segment">
      <ion-segment-button value="recipes">
        <ion-label>Recipes ({{ userProfile.recipeCount || 0 }})</ion-label>
      </ion-segment-button>
      <!-- You can add more segments like 'Following', 'Followers' later -->
    </ion-segment>

    <div *ngIf="userRecipes.length > 0" class="recipes-grid">
      <ion-card *ngFor="let recipe of userRecipes" [routerLink]="['/recipe-detail', recipe._id]">
        <img [src]="recipe.mainImage || 'assets/default-recipe.png'" alt="Recipe Image" /> <!-- FIXED: recipe.image to recipe.mainImage -->
        <ion-card-header>
          <ion-card-title>{{ recipe.title }}</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <div class="recipe-stats">
            <ion-icon name="heart"></ion-icon> {{ recipe.likes?.length || 0 }}
            <!-- <ion-icon name="bookmark"></ion-icon> {{ recipe.saves?.length || 0 }} FIXED: recipe.savedCount to recipe.saves?.length -->
            <ion-icon name="time-outline"></ion-icon> {{ recipe.metadata?.prepTime || 0 }} min <!-- FIXED: recipe.prepTime to recipe.metadata?.prepTime -->
          </div>
          <div class="actions">
            <ion-button fill="clear" color="primary" size="small" (click)="toggleLike(recipe); $event.stopPropagation()">
              <ion-icon [name]="recipe._hasLiked ? 'heart-sharp' : 'heart-outline'"></ion-icon>
            </ion-button>
            <ion-button fill="clear" color="primary" size="small" (click)="toggleSave(recipe); $event.stopPropagation()">
              <ion-icon [name]="recipe._isSaved ? 'bookmark-sharp' : 'bookmark-outline'"></ion-icon>
            </ion-button>
          </div>
        </ion-card-content>
      </ion-card>
    </div>

    <div *ngIf="userRecipes.length === 0 && userProfile" class="empty-state">
      <ion-icon name="restaurant-outline"></ion-icon>
      <h3>No Recipes Yet</h3>
      <p *ngIf="isOwner">You haven't posted any recipes. Start creating!</p>
      <p *ngIf="!isOwner">This chef hasn't posted any recipes yet.</p>
    </div>

  </div>

  <div *ngIf="!userProfile" class="empty-state"> <!-- FIXED: Removed !loading -->
    <ion-icon name="alert-circle-outline" color="danger"></ion-icon>
    <h3>Profile Not Found</h3>
    <p>Could not load user profile.</p>
  </div>

</ion-content>

<style>
  .user-profile-container {
    padding: 16px;
  }

  .header-section {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin-bottom: 24px;
    background: green;
    padding: 30px 20px;
    border-radius: 20px;
    color: white;
    box-shadow: 0 8px 24px rgba(var(--ion-color-primary-rgb), 0.3);
  }

  .profile-avatar {
    width: 100px;
    height: 100px;
    border: 4px solid white;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    margin-bottom: 15px;
  }

  .header-section h1 {
    font-size: 1.8rem;
    font-weight: bold;
    margin: 0 0 5px 0;
    color: white;
  }

  .followers-text {
    font-size: 1rem;
    color: rgba(255, 255, 255, 0.8);
    margin-bottom: 20px;
  }

  .header-section ion-button {
    --background: white;
    --color: var(--ion-color-primary);
    font-weight: bold;
    text-transform: capitalize;
    margin-top: 10px;
  }

  .header-section ion-button[fill="solid"] {
    --background: var(--ion-color-medium);
    --color: white;
  }

  .profile-segment {
    margin: 20px 0;
  }

  .profile-segment ion-segment-button {
    text-transform: capitalize;
    font-weight: 600;
  }

  .recipes-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
    gap: 15px;
  }

  .recipes-grid ion-card {
    margin: 0;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
  }

  .recipes-grid ion-card img {
    width: 100%;
    height: 120px;
    object-fit: cover;
  }

  .recipes-grid ion-card ion-card-header {
    padding: 10px;
  }

  .recipes-grid ion-card ion-card-title {
    font-size: 1rem;
    font-weight: 600;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    margin-bottom: 5px;
  }

  .recipes-grid ion-card ion-card-content {
    padding: 0 10px 10px;
  }

  .recipe-stats {
    display: flex;
    align-items: center;
    font-size: 0.8rem;
    color: var(--ion-color-medium);
    margin-bottom: 8px;
  }

  .recipe-stats ion-icon {
    font-size: 1rem;
    margin-right: 4px;
    color: var(--ion-color-primary);
  }

  .recipe-stats ion-icon:not(:first-child) {
    margin-left: 10px;
  }

  .actions {
    display: flex;
    justify-content: flex-end;
    margin-top: 5px;
  }

  .actions ion-button {
    --padding-start: 6px;
    --padding-end: 6px;
    --min-width: 30px;
    height: 30px;
    font-size: 1.1rem;
  }

  .empty-state {
    text-align: center;
    margin-top: 60px;
    padding: 20px;
    color: var(--ion-color-medium);
  }

  .empty-state ion-icon {
    font-size: 64px;
    color: var(--ion-color-medium);
    margin-bottom: 12px;
  }

  .empty-state h3 {
    font-weight: bold;
    margin: 8px 0;
    color: var(--ion-color-dark);
  }

  .empty-state p {
    font-size: 0.95rem;
    margin-bottom: 16px;
    color: var(--ion-color-medium);
  }
</style>